# grpc-dotnet-core
implementing C# portion from [pluralsight course](https://app.pluralsight.com/library/courses/grpc-enhancing-application-communication/table-of-contents)
using .NET core instead of full .NET.
implemented on a Windows 10 home edition using Visual Studio 2019 and vs code 

## Project Preparation 
there are some prerequisites to make this solution work:
1. protobuf compiler `protoc` installed
2. one or more protocol buffer description files
3. client and server certificate files as described in the batch file [`gencert.bat`](pkg/gencert.bat)

## Project Structure
One solution made of three projects as follows

### Messages 
This project is a .NET Core class library file, with two main files automatically generated by Protocol Buffer compiler `protoc`:
- Messages.cs
- MessagesGrpc.cs

both files are derieved from the input file `messages.proto` containing services, methods and message formats

for the generated code to work, we need the following nugets installed:
- Grpc.Tools
- Grpc.Core
- Google.Protobuf 

to generate code, we call the following command:

```bat
protoc -I pb messages.proto --csharp_out=. --grpc_out=. --plugin=protoc-gen-grpc=grpc_csharp_plugin.exe
```

in my implementation, I had to explicitly specify the location of grpc_csharp_plugin as `C:\Users\aawad\.nuget\packages\grpc.tools\2.25.0\tools\windows_x64\grpc_csharp_plugin.exe`
also, this command needs to properly point at:
- where to read proto files (the argument after `-I`), in my implementaion it was in a folder named pb
- where to automatically generate proto descriptors, in my implementation it was the root of Messages project
- where to automatically generate gRPC definition, in my implementation it was the root of Messages project

for convenience, I added a pre-build event in my MS Build script to run the same piece of code above, every time I rebuild the solution 

### GrpcServer
This is a simple .NET Core project, exposing concrete services described in Messages project.
for this project to work, we need the following nugets installed:
- Grpc.Tools
- Grpc.Core
- Google.Protobuf 
in addition to referncing Mesages project as a dependency 

also, for the server to function, we need to the following files from prerequisites step 3:
- ca.crt
- server.crt
- server.key

### GrpcClient 
This is another simple .NET Core project, consuming exposed services over gRPC connection. 
- Grpc.Core
- Google.Protobuf 
in addition to referncing Mesages project as a dependency 

also, for client function, we need the following files from prerequisite step 3:
- ca.crt
- client.crt
- client.key

## Main challenges
I faced the following issues to make my code work:
1. I could not make my server listen on IP4 port 9000, so I changed it to listen at the IP6 port using the following piece of code:
```csharp
Server server = new Server
            {
                Ports = { //new ServerPort("0.0.0.0", Port, sslCredentials),
                new ServerPort("[::]", Port, sslCredentials) } // listening on IP6 port 9000 
                
            };
```
1. I could not lookup the address of my server from client side until I introduced an enviroment variable for gRPC DNS resolver using the following piece of code:
```csharp
Environment.SetEnvironmentVariable("GRPC_DNS_RESOLVER",
                                               "native");
```